<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>顔面偏差値測定</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
    }
    input, button {
      margin: 10px;
    }
    img {
      max-width: 300px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>顔面偏差値測定</h1>
  <p>以下の利用規約に同意のうえ、顔写真をアップロードしてください。</p>
  <label>
    <input type="checkbox" id="agree"> 利用規約に同意する
  </label>
  <br>
  <input type="file" id="imageInput" accept="image/*" />
  <br>
  <img id="preview" src="#" alt="プレビュー画像" style="display: none;">
  <br>
  <button onclick="sendData()">顔面偏差値を測定</button>
  <p id="result"></p>

  <script>
    const input = document.getElementById("imageInput");
    const preview = document.getElementById("preview");

    input.addEventListener("change", function () {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          preview.src = e.target.result;
          preview.style.display = "block";
        };
        reader.readAsDataURL(file);
      }
    });

    async function sendData() {
      const checkbox = document.getElementById("agree");
      if (!checkbox.checked) {
        alert("利用規約に同意してください。");
        return;
      }

      const file = input.files[0];
      if (!file) {
        alert("画像を選択してください。");
        return;
      }

      // ダミーの顔面偏差値（AIモデル未連携のため）
      const score = Math.floor(Math.random() * 30) + 40; // 40〜70くらい

      const reader = new FileReader();
      reader.onloadend = async function () {
        const imageBase64 = reader.result;

        try {
          const response = await fetch("https://script.google.com/macros/s/AKfycbyMa1fJonsT6Lk8HVNZPesQmYCEbtIpIfEe_AR1p2D7_IEdTagCGDLDO0Xzkdaq0BJBAw/exec", {
            method: "POST",
            body: JSON.stringify({
              image: imageBase64,
              score: score
            }),
            headers: {
              "Content-Type": "application/json"
            }
          });

          const text = await response.text();
          document.getElementById("result").innerText = "送信成功！ 顔面偏差値: " + score + "\n（サーバー応答: " + text + "）";

        } catch (error) {
          document.getElementById("result").innerText = "送信に失敗しました。\n" + error;
        }
      };

      reader.readAsDataURL(file);
    }
  </script>
</body>
</html>
